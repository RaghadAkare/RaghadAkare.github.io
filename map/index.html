<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ù„ÙŠÙ„ Ø§Ù‚ØªØ·Ø§Ø¹ Ø§Ù„Ø·Ø±Ù‚ - Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ù†ÙˆØ¨Ø§Ù†ÙŠ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
    }

    .buffer-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #fff;
      padding: 15px;
      border: 2px solid #004d66;
      border-radius: 8px;
      width: 260px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 1001;
      display: none;
    }

    .buffer-panel h4 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #004d66;
    }

    .buffer-panel select,
    .buffer-panel button {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 4px;
    }

    .buffer-panel button {
      background-color: #004d66;
      color: white;
      border: none;
      cursor: pointer;
    }

    #loading-indicator {
      display: none !important;
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 5px 10px;
      border-radius: 4px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 1000;
    }


    .legend {
      background: white;
      padding: 10px;
      font-size: 12px;
      line-height: 1.5;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      border: 2px solid black;
    }

    /* âœ… Ø²Ø± Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ */
    #layer-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1002;
      background-color: white;
      color: black;
      padding: 10px 20px;
      border: 2px solid black;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size:18px;
    }

    /* âœ… ØªØµÙ…ÙŠÙ… Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
    #layer-box {
      position: absolute;
      top: 70px;
      right: 20px;
      z-index: 1001;
      background: white;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      display: none;
    }
#map-title {
  position: absolute;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: #f5f5dc; /* Ø¨ÙŠØ¬ Ù†Ø§Ø¹Ù… */
  color: #000000;       /* Ø®Ø· Ø£Ø³ÙˆØ¯ */
  padding: 12px 30px;
  border-radius: 10px;
  font-size: 18px;
  font-weight: bold;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  z-index: 2000;
  border: 1px solid #aaa;
}

  </style>
</head>
<body>
<div id="map-title">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÙŠÙ„ Ø§Ù‚ØªØ·Ø§Ø¹ Ø§Ù„Ø·Ø±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ ÙÙŠ Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ù†ÙˆØ¨Ø§Ù†ÙŠ</div>
<div id="map"></div>
<button id="layer-toggle">Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
<div class="buffer-panel" id="buffer-panel">
  <h4>ØªØ­Ù„ÙŠÙ„ Ø§Ù‚ØªØ·Ø§Ø¹ Ø§Ù„Ø·Ø±ÙŠÙ‚</h4>
  <label> : (Buffer) Ø§Ø®ØªØ± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø§Ø²Ù„Ø© Ø¨Ø§Ù„Ù…ØªØ±  </label>
<select id="buffer-width">
  <option value="2">2</option>
  <option value="4">4</option>
  <option value="6">6</option>
  <option value="8">8</option>
  <option value="10">10</option>
</select>

  <button onclick="applyBuffer()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙØ±</button>
  <button id="reset-btn" onclick="resetAnalysis()" style="background:#ccc;color:#000;margin-top:5px;display:none">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
</div>
<!-- Ø²Ø± ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø« -->
<div id="search-toggle" style="position:absolute; top:70px; right:20px; z-index:1001;">
  <button onclick="toggleSearchPanel()" style="background:white; color:black; border: 2px solid black;padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold;font-size:18px;">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø·Ø¹Ø© Ø£Ø±Ø¶Ùƒ</button>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø« -->
<div id="search-panel" style="display:none; position:absolute; top:120px; right:20px; background:white; padding:15px; border:2px solid #004d66; border-radius:8px; width:260px; z-index:1001;">
  <h4 style="margin-top:0; color:#004d66;">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:</h4>
  <select id="parcel-select" style="width:100%; padding:6px; border-radius:4px;"></select>
  <button onclick="searchParcel()" style="margin-top:8px; width:100%; background:#004d66; color:white; padding:8px; border:none; border-radius:4px;">Ø¨Ø­Ø«</button>
  <button onclick="resetSearch()" style="margin-top:5px; width:100%; background:#ccc; color:black; padding:8px; border:none; border-radius:4px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
</div>
<div id="loading-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... <span id="layers-loaded">0</span>/6</div>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script>
const map = L.map('map').setView([32.0264, 35.1331], 15);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Â© ESRI World Imagery'
}).addTo(map);
const layerControl = L.control.layers(null, null, { collapsed: false }).addTo(map);
// ğŸ‘‡ Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø¬Ø¯ÙŠØ¯ ÙŠÙ„Ù Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠÙ‡ Ø¨Ø§Ù„Ø²Ø±
const layerBox = document.createElement('div');
layerBox.id = 'layer-box';
document.body.appendChild(layerBox);

// ğŸ‘‡ Ø­Ø±Ùƒ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
const layersControlElement = document.querySelector('.leaflet-control-layers');
layerBox.appendChild(layersControlElement);

// ğŸ‘‡ ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
document.getElementById('layer-toggle').addEventListener('click', () => {
  const box = document.getElementById('layer-box');
  box.style.display = (box.style.display === 'block') ? 'none' : 'block';
});
let loadedLayers = 0;
let parcelsLayer, selectedRoadFeature, roadLayer, bufferLayer;
let originalStyles = new Map();
let highlightedParcels = [];
const allBounds = [];

function updateLoading() {
  document.getElementById('layers-loaded').textContent = loadedLayers;
  if (loadedLayers >= 6) document.getElementById('loading-indicator').style.display = 'none';
}

function getColor(width) {
  if (width <= 4) return '#1f77b4';
  if (width <= 6) return '#2ca02c';
  if (width <= 8) return '#d62728';
  if (width <= 10) return '#9467bd';
  if (width <= 12) return '#ff7f0e';
  if (width <= 14) return '#17becf';
  return '#8c564b';
}

fetch('https://cdn.jsdelivr.net/gh/RaghadAkare/RaghadAkare.github.io/Parcels.geojson')
  .then(res => res.json())
  .then(data => {
    parcelsLayer = L.geoJSON(data, {
      style: { color: "#996633", weight: 1, fillColor: "#f5f5dc", fillOpacity: 0.6 },
      onEachFeature: (feature, layer) => {
        originalStyles.set(layer._leaflet_id, { color: "#996633", weight: 1, fillColor: "#f5f5dc", fillOpacity: 0.6 });
        const id = feature.properties.ParcelNumb || '-';
        const blockNum = feature.properties.BlockNumbe || '-';
        const blockName = feature.properties.BlockName_ || '-';
        layer.bindPopup(`Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${id}<br>Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ¶: ${blockNum}<br>Ø§Ø³Ù… Ø§Ù„Ø­ÙˆØ¶: ${blockName}`);
      }
    }).addTo(map);

    setTimeout(() => {
      if (parcelsLayer.getBounds().isValid()) {
        allBounds.push(parcelsLayer.getBounds());
      }
    }, 100);

    layerControl.addOverlay(parcelsLayer, 'Ù‚Ø·Ø¹ Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„ØªÙˆØ³Ø¹');
    populateParcelDropdown();
    loadedLayers++;
    updateLoading();

    document.getElementById('parcel-select').addEventListener('change', function () {
      if (this.value === 'more') {
        showAllParcels();
      }
    });
  });

fetch('https://cdn.jsdelivr.net/gh/RaghadAkare/RaghadAkare.github.io/mazari.geojson')
  .then(res => res.json())
  .then(data => {
    const layer = L.geoJSON(data, { style: { color: "brown", weight: 2, fill: false } }).addTo(map);

    setTimeout(() => {
      if (layer.getBounds().isValid()) {
        allBounds.push(layer.getBounds());
      }
    }, 100);

    layerControl.addOverlay(layer, 'Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ù‚Ø±ÙŠØ©');
    loadedLayers++;
    updateLoading();
  });

fetch('https://raw.githubusercontent.com/RaghadAkare/RaghadAkare.github.io/main/Roads.geojson')
  .then(res => res.json())
  .then(data => {
    roadLayer = L.geoJSON(data, {
      style: f => {
        const w = parseFloat(f.properties.width);
        return { color: getColor(w), weight: 2, dashArray: "3,3", fill: true, fillOpacity: 0.01 };
      },
      onEachFeature: (feature, layer) => {
        const width = feature.properties.width;
        layer.bindPopup(`ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ø±ÙŠÙ‚: ${width} Ù…`);

        layer.on('click', function (e) {
          selectedRoadFeature = feature;
          document.getElementById('buffer-panel').style.display = 'block';
          layer.openPopup(e.latlng);
        });
      }
    }).addTo(map);

    setTimeout(() => {
      if (roadLayer.getBounds().isValid()) {
        allBounds.push(roadLayer.getBounds());
      }
    }, 100);

    layerControl.addOverlay(roadLayer, 'Ø´Ø¨ÙƒØ© Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ³Ø¹');
    loadedLayers++;
    updateLoading();
  });

fetch('https://cdn.jsdelivr.net/gh/RaghadAkare/RaghadAkare.github.io@main/Ump_expansion.geojson')
  .then(res => {
    if (!res.ok) throw new Error('ğŸš¨ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
    return res.json();
  })
  .then(data => {
    const expansionLayer = L.geoJSON(data, {
      style: { color: "blue", weight: 1, fill: false }
    }).addTo(map);

    setTimeout(() => {
      if (expansionLayer.getBounds().isValid()) {
        allBounds.push(expansionLayer.getBounds());
      }
    }, 100);

    layerControl.addOverlay(expansionLayer, 'Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªÙˆØ³Ø¹Ø©');
    loadedLayers++;
    updateLoading();
    console.log('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªÙˆØ³Ø¹Ø©!');
  })
  .catch(err => console.error('âŒ Ø­ØµÙ„ Ø®Ø·Ø£:', err));

fetch('https://cdn.jsdelivr.net/gh/RaghadAkare/RaghadAkare.github.io/roads_inside.geojson')
  .then(res => res.json())
  .then(data => {
    const layer = L.geoJSON(data, {
      style: f => {
        const w = parseFloat(f.properties.width);
        return { color: getColor(w), weight: 2, fill: false };
      }
    }).addTo(map);

    setTimeout(() => {
      if (layer.getBounds().isValid()) {
        allBounds.push(layer.getBounds());
      }
    }, 100);

    layerControl.addOverlay(layer, 'Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø®Ø·Ø·');
    loadedLayers++;
    updateLoading();
  });

const others = [
  ['roads_network.geojson', 'Ø´Ø¨ÙƒØ© Ø§Ù„Ø·Ø±Ù‚', { color: "black", weight: 2, dashArray: "5,5", fill: false }],
  ['Ump_blocks.geojson', 'Ø£Ø­ÙˆØ§Ø¶ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠ', { color: "lightgreen", weight: 2, fill: false }],
  ['boundry_master.geojson', 'Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠ', { color: "blue", weight: 2, fill: false }],
  ['tapo_bocks.geojson', 'Ø£Ø­ÙˆØ§Ø¶ Ø§Ù„Ø·Ø§Ø¨Ùˆ', { color: "orange", weight: 2, fill: false }],
  ['objection.geojson', 'Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶', { color: "purple", weight: 2, dashArray: "5,5", fill: false }]
];

others.forEach(([file, name, style]) => {
  fetch('https://cdn.jsdelivr.net/gh/RaghadAkare/RaghadAkare.github.io/' + file)
    .then(res => res.json())
    .then(data => {
      const layer = L.geoJSON(data, { style });

      setTimeout(() => {
        if (layer.getBounds && layer.getBounds().isValid()) {
          allBounds.push(layer.getBounds());
        }
      }, 100);

      layerControl.addOverlay(layer, name); // ÙÙ‚Ø· Ø£Ø¶Ù Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø©
    });
});

map.whenReady(() => {
  setTimeout(() => {
    if (allBounds.length > 0) {
      const fullBounds = allBounds.reduce((acc, b) => acc.extend(b), allBounds[0]);
      map.fitBounds(fullBounds, { padding: [30, 30] });
    }
  }, 300);
});

function applyBuffer() {
  const width = parseFloat(document.getElementById('buffer-width').value);
  if (!selectedRoadFeature || isNaN(width)) return;

  if (bufferLayer) map.removeLayer(bufferLayer);

  const buffer = turf.buffer(selectedRoadFeature, width / 2, { units: 'meters' });
  bufferLayer = L.geoJSON(buffer, { style: { color: 'blue', weight: 1, fillOpacity: 0.1 } }).addTo(map);

  parcelsLayer.eachLayer(layer => {
    const parcel = layer.feature;
    const parcelPolygon = parcel.geometry;
    const intersection = turf.intersect(buffer, parcel);
    const num = parcel.properties.ParcelNumb || "-";
    const block = parcel.properties.BlockNumbe || "-";
    const name = parcel.properties.BlockName_ || "-";

    const original = originalStyles.get(layer._leaflet_id);

    if (intersection) {
      const cutArea = turf.area(intersection);
      const parcelArea = turf.area(parcel);
      const ratio = (cutArea / parcelArea) * 100;

      // Ù†Ø­Ø§ÙˆÙ„ Ù†Ø­Ø³Ø¨ Ø£ÙƒØ¨Ø± Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      const bbox = turf.bbox(intersection); // [minX, minY, maxX, maxY]
      const estimatedWidth = turf.distance(
        [bbox[0], (bbox[1] + bbox[3]) / 2],
        [bbox[2], (bbox[1] + bbox[3]) / 2],
        { units: 'meters' }
      );

      let popup = `Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${num}<br>Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ¶: ${block}<br>Ø§Ø³Ù… Ø§Ù„Ø­ÙˆØ¶: ${name}<br>`;
      popup += `ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù‚ØªØ·Ø§Ø¹: ${ratio.toFixed(1)}%<br>`;
      popup += `ğŸ“ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: ${estimatedWidth.toFixed(1)} Ù…<br>`;

      if (ratio > 30 && estimatedWidth < 12) {
        layer.setStyle({ color: '#FFD700', fillColor: '#FFD700' }); // Ø£ØµÙØ±
        popup += `âš ï¸ Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù‚ØªØ·Ø§Ø¹ ÙƒØ¨ÙŠØ± + Ø¹Ø±Ø¶ Ø£Ù‚Ù„ Ù…Ù† 12Ù…`;
      } else if (ratio > 30) {
        layer.setStyle({ color: '#cc0000', fillColor: '#cc0000' }); // Ø£Ø­Ù…Ø±
        popup += `ğŸš§ Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ù‚ØªØ·Ø§Ø¹ ÙƒØ¨ÙŠØ±`;
      } else if (estimatedWidth < 12) {
        layer.setStyle({ color: 'blue', fillColor: 'blue' }); // Ø£Ø²Ø±Ù‚
        popup += `ğŸ”µ Ø§Ù„Ø­Ø§Ù„Ø©: Ø¹Ø±Ø¶ Ø£Ù‚Ù„ Ù…Ù† 12Ù…`;
      } else {
        layer.setStyle(original);
        popup += `âœ… Ø§Ù„Ø­Ø§Ù„Ø©: Ø¢Ù…Ù†`;
      }

      layer.bindPopup(popup);
    } else {
      layer.setStyle(original);
      layer.bindPopup(`Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${num}<br>Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ¶: ${block}<br>Ø§Ø³Ù… Ø§Ù„Ø­ÙˆØ¶: ${name}`);
    }
  });

  document.getElementById('reset-btn').style.display = 'block';
showBufferLegend();
}


function resetAnalysis() {
  if (bufferLayer) {
    map.removeLayer(bufferLayer);
    bufferLayer = null;
  }
  selectedRoadFeature = null;
  parcelsLayer.eachLayer(layer => {
    const original = originalStyles.get(layer._leaflet_id);
    if (original) {
      layer.setStyle(original);
    } else {
      layer.setStyle({ color: '#996633', weight: 1, fillColor: '#f5f5dc', fillOpacity: 0.6 });
    }
    const f = layer.feature;
    layer.bindPopup(`Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${f.properties.ParcelNumb || "-"}<br>Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ¶: ${f.properties.BlockNumbe || "-"}<br>Ø§Ø³Ù… Ø§Ù„Ø­ÙˆØ¶: ${f.properties.BlockName_ || "-"}`);
  });
  document.getElementById('reset-btn').style.display = 'none';
  document.getElementById('buffer-panel').style.display = 'none';
hideBufferLegend();
}
function toggleSearchPanel() {
  const panel = document.getElementById('search-panel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}
let allParcels = []; // Ù„ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
let loadedParcels = false;

function populateParcelDropdown() {
  const select = document.getElementById('parcel-select');
  select.innerHTML = '';
  allParcels = [];

  parcelsLayer.eachLayer(layer => {
    const id = layer.feature.properties.ParcelNumb;
    const block = layer.feature.properties.BlockNumbe;
    if (id && block) {
      const label = `Ù‚Ø·Ø¹Ø© ${id} - Ø­ÙˆØ¶ ${block}`;
      const value = `${id}|${block}`; // Ø§Ø³ØªØ®Ø¯Ù… ÙØ§ØµÙ„ Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù‚ÙŠÙ…ØªÙŠÙ†
      allParcels.push({ value, label });
    }
  });

  const initial = allParcels.slice(0, 4);
  initial.forEach(({ value, label }) => {
    const option = document.createElement('option');
    option.value = value;
    option.textContent = label;
    select.appendChild(option);
  });

  const moreOption = document.createElement('option');
  moreOption.value = 'more';
  moreOption.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯...';
  select.appendChild(moreOption);

  loadedParcels = false;
}


function searchParcel() {
  const selectedValue = document.getElementById('parcel-select').value;

  if (selectedValue === 'more') {
    showAllParcels();
    return;
  }

  const [selectedId, selectedBlock] = selectedValue.split('|');

  highlightedParcels.forEach(layer => {
    const original = originalStyles.get(layer._leaflet_id);
    if (original) layer.setStyle(original);
  });

  highlightedParcels = [];

  parcelsLayer.eachLayer(layer => {
    const id = layer.feature.properties.ParcelNumb;
    const block = layer.feature.properties.BlockNumbe;
if (id == selectedId && block == selectedBlock) {
  layer.setStyle({ color: 'yellow', weight: 2, fillColor: 'yellow', fillOpacity: 0.7 });
  highlightedParcels.push(layer);
  map.fitBounds(layer.getBounds());
}


  });

  showSearchLegend();
}

function showAllParcels() {
  const select = document.getElementById('parcel-select');
  select.innerHTML = '';

  allParcels.forEach(({ value, label }) => {
    const option = document.createElement('option');
    option.value = value;
    option.textContent = label;
    select.appendChild(option);
  });

  loadedParcels = true;
  select.focus();
  select.size = 6;
}



function resetSearch() {
  highlightedParcels.forEach(layer => {
    const original = originalStyles.get(layer._leaflet_id);
    if (original) {
      layer.setStyle(original);
    } else {
      layer.setStyle({ color: '#996633', weight: 1, fillColor: '#f5f5dc', fillOpacity: 0.6 });
    }
  });
  highlightedParcels = [];
  parcelsLayer.eachLayer(layer => {
    const f = layer.feature;
    layer.bindPopup(`Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${f.properties.ParcelNumb || "-"}<br>Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ¶: ${f.properties.BlockNumbe || "-"}<br>Ø§Ø³Ù… Ø§Ù„Ø­ÙˆØ¶: ${f.properties.BlockName_ || "-"}`);
  });
  document.getElementById('parcel-select').selectedIndex = 0;
  hideSearchLegend();
}

function toggleSearchPanel() {
  const panel = document.getElementById('search-panel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}
var legend = L.control({ position: 'bottomright' });
legend.onAdd = function (map) {
  const div = L.DomUtil.create('div', 'legend');
  div.style.marginBottom = '50px'; // âœ¨ Ø§Ø±ÙØ¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„ÙÙˆÙ‚ Ø´ÙˆÙŠ

  div.innerHTML += "<b>Ø¹Ø±Ø¶ Ø§Ù„Ø·Ø±Ù‚ Ø¨Ø§Ù„Ù…ØªØ±</b><br>";
const widths = [
  { color: '#1f77b4', label: 'Ø¹Ø±Ø¶ â‰¤ 4 Ù…' },
  { color: '#2ca02c', label: 'Ø¹Ø±Ø¶ â‰¤ 6 Ù…' },
  { color: '#d62728', label: 'Ø¹Ø±Ø¶ â‰¤ 8 Ù…' },
  { color: '#9467bd', label: 'Ø¹Ø±Ø¶ â‰¤ 10 Ù…' },
  { color: '#ff7f0e', label: 'Ø¹Ø±Ø¶ â‰¤ 12 Ù…' },
  { color: '#17becf', label: 'Ø¹Ø±Ø¶ â‰¤ 14 Ù…' },
  { color: '#8c564b', label: 'Ø¹Ø±Ø¶ > 14 Ù…' }
];

  widths.forEach(w => {
    div.innerHTML += `<div style="display: flex; align-items: center; margin-bottom: 4px;">
                        <div style="width: 30px; height: 2px; background:${w.color}; margin-left: 6px;"></div>
                        <span>${w.label}</span>
                      </div>`;
  });

  return div;
};
legend.addTo(map);

// âœ… Ù…Ù„Ø§Ø­Ø¸Ø© Ø«Ø§Ø¨ØªØ© Ø¨Ø£Ø³ÙÙ„ ÙŠÙ…ÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø®Ø§Ø±Ø¬ ØªØ­ÙƒÙ… Leaflet)
const noteDiv = document.createElement('div');
noteDiv.id = 'buffer-note';
noteDiv.innerHTML = `âš ï¸ <strong>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</strong> Ø£Ù†Ù‡ ÙŠØ¬Ø¨ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø§Ø¯ ÙØ­Øµ Ø§Ù„ØªÙˆØ³Ø¹Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠÙ‡Ø§ (<strong>Buffer Zone</strong>).`;

// ğŸ¨ ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ù…Ø¨Ø§Ø´Ø±Ø©
noteDiv.style.position = 'absolute';
noteDiv.style.bottom = '10px';
noteDiv.style.right = '10px';
noteDiv.style.background = 'pink';
noteDiv.style.border = '1px solid #ccc';
noteDiv.style.borderRadius = '6px';
noteDiv.style.padding = '8px 12px';
noteDiv.style.fontSize = '15px';
noteDiv.style.boxShadow = '0 0 5px rgba(0,0,0,0.3)';
noteDiv.style.zIndex = '1000';

document.body.appendChild(noteDiv);



// Ø²Ø± Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
document.getElementById('layer-toggle').addEventListener('click', () => {
  const box = document.querySelector('.leaflet-control-layers');
  if (box.style.display === 'block') {
    box.style.display = 'none';
  } else {
    box.style.display = 'block';
  }
});
// ğŸŸ¨ Ù…ÙØªØ§Ø­ Ø®Ø§Øµ Ø¨ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙØ±
let bufferLegend;

function showBufferLegend() {
  if (bufferLegend) return; // Ù…Ø§ Ù†Ø¶ÙŠÙÙ‡ Ù…Ø±ØªÙŠÙ†

  bufferLegend = L.control({ position: 'bottomleft' });
  bufferLegend.onAdd = function (map) {
    const div = L.DomUtil.create('div', 'legend');
    div.innerHTML = "<b>ØªØ­Ù„ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ÙØ±</b><br>";
    div.innerHTML += `<div style="margin-bottom:4px;"><span style="display:inline-block;width:12px;height:12px;background:#cc0000;margin-left:6px;border-radius:2px;"></span> Ø§Ù‚ØªØ·Ø§Ø¹ ÙƒØ¨ÙŠØ± ÙÙ‚Ø·</div>`;
    div.innerHTML += `<div style="margin-bottom:4px;"><span style="display:inline-block;width:12px;height:12px;background:blue;margin-left:6px;border-radius:2px;"></span> Ø¹Ø±Ø¶ Ø£Ù‚Ù„ Ù…Ù† 12Ù… ÙÙ‚Ø·</div>`;
    div.innerHTML += `<div style="margin-bottom:4px;"><span style="display:inline-block;width:12px;height:12px;background:#FFD700;margin-left:6px;border-radius:2px;"></span> Ø§Ù‚ØªØ·Ø§Ø¹ ÙƒØ¨ÙŠØ± + Ø¹Ø±Ø¶ Ø£Ù‚Ù„ Ù…Ù† 12Ù…</div>`;
    return div;
  };
  bufferLegend.addTo(map);
}

function hideBufferLegend() {
  if (bufferLegend) {
    map.removeControl(bufferLegend);
    bufferLegend = null;
  }
}
// âœ… Ù…ÙØªØ§Ø­ Ø®Ø§Øµ Ø¨Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
let searchLegend;

function showSearchLegend() {
  if (searchLegend) return;

  searchLegend = L.control({ position: 'bottomleft' });
  searchLegend.onAdd = function (map) {
    const div = L.DomUtil.create('div', 'legend');
    div.innerHTML = "<b>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«</b><br>";
   div.innerHTML += `<div style="margin-bottom:4px;"><span style="display:inline-block;width:12px;height:12px;background:yellow;margin-left:6px;border-radius:2px;"></span> Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</div>`;
    return div;
  };
  searchLegend.addTo(map);
}

function hideSearchLegend() {
  if (searchLegend) {
    map.removeControl(searchLegend);
    searchLegend = null;
  }
}

</script>
</body>
</html>
